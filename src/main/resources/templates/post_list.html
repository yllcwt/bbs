<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="import :: head_js"></div>
    <link href="/css/dashboard.css" rel="stylesheet">
    <style>
        .navbar-default {
            background-color: #b1cdff;
        }
        .nav-tabs {
            border-bottom: 1px solid #ddd;
            margin-bottom: 10px;
        }
        .breadcrumb{
            float: right;
            background: transparent;
            margin-top: 0;
            margin-bottom: 0;
            font-size: 12px;
            padding: 7px 5px;
            position: absolute;
            top: 15px;
            right: 20px;
            border-radius: 2px;
        }
        .content-header{
            display: block;
            padding-left: 20px;
            padding-right: 20px;
        }
        .label{
            color: #fff;
            background-color: #8a8a8a;
        }
    </style>
</head>
<body>
<div th:replace="bar :: top_menu"></div>
<div class="row">

    <div th:replace="bar :: sider_menu(activeUri='post_list')"></div>
    <div class="col-md-10 col-md-offset-2 content-wrapper">

        <style>
            .form-horizontal .control-label {
                text-align: left;
            }
        </style>
        <section class="content-header">
            <h1 style="display: inline-block">
                文章列表
                <small></small>
            </h1>
            <ol class="breadcrumb">
                <li>
                    <a data-pjax="true" href="/admin">
                        <i class="fa fa-dashboard"></i> 首页</a>
                </li>
                <li class="active">文章列表</li>
            </ol>
        </section>
        <div class="container-fluid">
            <div class="col-md-12">
                <div class="col-md-4 col-xs-12" style="margin-bottom: 10px;padding-left: 0;">
                    <a class="btn btn-primary" href="/admin/post/new">
                        <i class="fa fa-plus"></i> 新增
                    </a>
                    <button type="button" class="btn btn-danger" onclick="batchDelete()">
                        <i class="fa fa-remove"></i> 批量删除
                    </button>
                </div>
                <div class="col-md-8 col-xs-12" style="margin-bottom: 10px; text-align:right;padding-left: 0; padding-right: 0;">
                    <form class="form-inline" action="/postManage">
                        <div class="form-group">
                            <input type="text" class="form-control" id="keywords" name="keywords"  placeholder="请输入关键字">
                        </div>
                        <div class="form-group">
                            <select class="form-control" name="searchType">
                                <option value="post_title" disabled="">搜索范围</option>
                                <option value="post_title">标题</option>
                                <option value="post_content">内容</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select class="form-control" name="sort">
                                <option value="post_time" disabled="">排序字段</option>
                                <option value="post_time">发布时间</option>
                                <option value="post_view">访问量</option>
                                <option value="post_comment_count">回复数</option>
                                <option value="post_like">点赞数</option>
                                <option value="post_top">是否置顶</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select class="form-control" name="order">
                                <option value="desc" disabled="">升序/降序</option>
                                <option value="asc">升序</option>
                                <option value="desc" selected="selected">倒序</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary"><i class="fa fa-search"></i> 搜索</button>
                    </form>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="box box-primary">
                    <div class="box-body table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead>
                            <tr>
                                <th><input type="checkbox" id="allSelect" onclick="doCheck()"></th>
                                <th class="col-md-5">标题</th>
                                <th>回复数</th>
                                <th>点赞数</th>
                                <th>访问量</th>
                                <th>日期</th>
                                <th class="col-md-3">操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="post : ${paginationDTO.getData()}" th:id="'post-'+${post.postId}">
                                <td><input type="checkbox" name="ids" th:value="${post.postId}"></td>
                                <td>
                                    <label>
                                        <span style="color: #087623" th:if="${post.postTop}">【置顶】</span>
                                        <a th:href="@{'/post/'+${post.postId}}" target="_blank" th:text="${post.postTitle}">
                                        </a>
                                    </label>
                                </td>
                                <td>
                                    <span class="label" th:text="${post.postCommentCount}"></span>
                                </td>
                                <td>
                                    <span class="label" th:text="${post.postLike}"></span>
                                </td>
                                <td>
                                    <span class="label" th:text="${post.postView}"></span>
                                </td>
                                <td th:text="${#dates.format(post.postTime, 'yyyy-MM-dd HH:mm')}"></td>

                                <td>
                                    <a th:href="@{'/post/'+${post.postId}}" class="btn btn-primary btn-xs" target="_blank">查看</a>
                                    <button class="btn btn-success btn-xs " th:if="${post.postTop==0}" th:onclick="stickIt([[${post.postId}]])">置顶
                                    </button>
                                    <button class="btn btn-success btn-xs " th:if="${post.postTop==1}" th:onclick="unStickIt([[${post.postId}]])">取消置顶
                                    </button>

                                    <a th:href="@{/postEdit(postId=${post.postId})}" class="btn btn-info btn-xs ">编辑</a>
                                    <button class="btn btn-danger btn-xs " th:onclick="throwIt([[${post.postId}]])">
                                        删除
                                    </button>
                                </td>


                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="box-footer clearfix">
                        <div class="no-margin pull-left" th:text="'第 '+${paginationDTO.page}+' / '+${paginationDTO.totalPage}+' 页'">
                        </div>
                        <ul class="pagination no-margin pull-right">
                            <li><a  th:class="'btn btn-sm'+(${paginationDTO.showFirstPage==true} ? ' ' : ' disabled')" th:href="@{/postManage(pageIndex=1,pageSize=3)}">
                                首页
                            </a>
                            </li>
                            <li><a  th:class="'btn btn-sm'+(${paginationDTO.showPrevious==true} ? ' ' : ' disabled')" th:href="@{/postManage(pageIndex=${paginationDTO.page-1},pageSize=3)}">
                                上一页
                            </a>
                            </li>
                            <li><a  th:class="'btn btn-sm'+(${paginationDTO.showNext==true} ? ' ' : ' disabled')" th:href="@{/postManage(pageIndex=${paginationDTO.page+1},pageSize=3)}">
                                下一页
                            </a>
                            </li>
                            <li><a data-pjax="true" th:class="'btn btn-sm'+(${paginationDTO.showEndPage==true} ? ' ' : ' disabled')" th:href="@{/postManage(pageIndex=${paginationDTO.totalPage},pageSize=3)}">
                                尾页
                            </a>
                            </li>
<!--                            class="btn btn-sm disabled" href="/admin/post?status=0&amp;page=1&amp;searchType=&amp;keywords=&amp;sort=isSticky desc, createTime&amp;order=desc"-->
                        </ul>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    /**
     * 全选和反选
     * @constructor
     */
    function doCheck() {
        var ch = document.getElementsByName("ids");
        if (document.getElementById("allSelect").checked == true) {
            for (var i = 0; i < ch.length; i++) {
                ch[i].checked = true;
            }
        } else {
            for (var i = 0; i < ch.length; i++) {
                ch[i].checked = false;
            }
        }
    }
    function showMsgAndReload(text, icon, hideAfter) {
        if (heading == undefined) {
            var heading = "提示";
        }
        $.toast({
            text: text,
            heading: heading,
            icon: icon,
            showHideTransition: 'fade',
            allowToastClose: true,
            hideAfter: hideAfter,
            stack: 1,
            position: 'top-center',
            textAlign: 'left',
            loader: true,
            loaderBg: '#ffffff',
            afterHidden: function () {
                window.location.reload();
            }
        });
    }
    function batchDelete() {
        var arr = [];
        $('input[name="ids"]:checked').each(function () {
            arr.push($(this).val());
        });
        if (arr.length <= 0) {
            showMsg('请选择需要删除的数据', "error", 1000);
        } else {
            layer.confirm('请确认是否删除', function (index) {
                $.ajax({
                    url: "/postBatchDelete?ids=" + arr,
                    type: "Get",
                    success: function (data) {
                        if (data.code == 0) {
                            showMsg(data.msg, "error", 1000);
                        } else {
                            showMsgAndReload(data.msg, "success", 2000);
                        }
                    }
                });
                layer.close(index);
            });
        }
    }
    function stickIt(id) {
        $.ajax({
            type: 'POST',
            url: '/postStickIt',
            async: false,
            data: {
                'postId': id
            },
            success: function (data) {
                if (data.code == 0) {
                    showMsg(data.msg, "error", 1000);
                } else {
                    showMsgAndReload(data.msg, "success", 1500);

                }
            }
        });
    }

    function unStickIt(id) {
        $.ajax({
            type: 'POST',
            url: '/postUnStickIt',
            async: false,
            data: {
                'postId': id
            },
            success: function (data) {
                if (data.code == 0) {
                    showMsg(data.msg, "error", 1000);
                } else {
                    showMsgAndReload(data.msg, "success", 1500);

                }
            }
        });
    }

    function throwIt(id) {
        layer.confirm('请确认是否删除', function (index) {
            $.ajax({
                type: 'POST',
                url: '/postThrowIt',
                async: false,
                data: {
                    'postId': id
                },
                success: function (data) {
                    if (data.code == 0) {
                        showMsg(data.msg, "error", 1000);
                    } else {
                        showMsgAndReload(data.msg, "success", 1500);

                    }
                }
            });
            layer.close(index);
        });
    }

</script>
<div th:replace="import :: footer_js"></div>
<script src="/static/js/plugins/layer/layer.js" ></script>

</body>
</html>